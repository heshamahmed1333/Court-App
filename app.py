import streamlit as st
import pandas as pd

# ุฅุนุฏุงุฏ ุงูุตูุญุฉ ูุชููู ูุงุณุนุฉ ููุฑูุญุฉ ููุนูู
st.set_page_config(page_title="ูุธุงู ุณูุฑุชุงุฑูุฉ ุงูููุถ", layout="wide")

st.title("โ๏ธ ูุธุงู ุชูุฒูุน ุทุนูู ุงูุฌูุณุฉ ุงูุฐูู")
st.write("ุฑุฆุงุณุฉ ุงููุณุชุดุงุฑ/ ูุจูู ุงููุดูู")

# ูุงุฆูุฉ ุงููุณุชุดุงุฑูู ุจุงูุชุฑุชูุจ (ุงูุฃูุฏููุฉ)
judges_names = [
    "ูุจูู ุงููุดูู", "ุณุงูุญ ุนุจุฏ ุงูุฑุญูู", "ูุญููุฏ ุตุฏูู", 
    "ูุงุฌุฏ ุงุจุฑุงููู", "ูุญุณู ุฃุจู ุจูุฑ", "ุญุงุชู ุบุฑุงุจ", 
    "ููุงู ุนุจุฏ ุงูููู", "ูุญูุฏ ููุตูุฑ", "ูุญูุฏ ูุคุงุฏ"
]

# ูุฎุฒู ุงูุจูุงูุงุช ุงููุคูุช
if 'cases' not in st.session_state:
    st.session_state.cases = []

# --- ุงูุฌุฒุก ุงูุฌุงูุจู ูุฅุฏุฎุงู ุงูุจูุงูุงุช ---
with st.sidebar:
    st.header("๐ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุทุนู")
    date_val = st.text_input("ุชุงุฑูุฎ ุงูุฌูุณุฉ", value="06-02-2026")
    c_no = st.text_input("ุฑูู ุงูุทุนู")
    c_year = st.text_input("ุงูุณูุฉ")
    c_appellant = st.text_input("ุงุณู ุงูุทุงุนู")
    c_court = st.text_input("ุงููุญููุฉ ุงููุตุฏุฑ")
    c_charge = st.text_input("ุงูุชููุฉ")

    if st.button("ุฅุถุงูุฉ ุงูุทุนู"):
        if c_no:
            st.session_state.cases.append({
                'ุฑูู ุงูุทุนู': c_no, 'ุงูุณูุฉ': c_year,
                'ุงุณู ุงูุทุงุนู': c_appellant, 'ุงููุญููุฉ ุงููุตุฏุฑ': c_court,
                'ุงูุชููุฉ': c_charge
            })
            st.toast(f"ุชู ุฅุถุงูุฉ ุทุนู ุฑูู {c_no}")
        else:
            st.error("ุจุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุงูุทุนู!")

# --- ุงูุฌุฒุก ุงูุฑุฆูุณู ูููุนุงูุฌุฉ ---
if st.session_state.cases:
    st.header("๐ ุฌุฏูู ูุถุน ุงูุนูุงูุงุช (+ ููููุฑุฑ / - ูููุดุชุฑู)")
    st.info("ููุงุญุธุฉ: (ูุจููุ ุณุงูุญุ ูุญููุฏ) ูุชู ุฅุถุงูุชูู ุชููุงุฆูุงู ูู ู1 ูู2 ูู3 ูู ุงููุชูุฌุฉ ุงูููุงุฆูุฉ.")
    
    # ุชุญููู ุงูุจูุงูุงุช ูุฌุฏูู ูุงุจู ููุชุนุฏูู
    df_input = pd.DataFrame(st.session_state.cases)
    for name in judges_names:
        df_input[name] = ""
    
    # ุนุฑุถ ุงูุฌุฏูู ููููุธู ููุถุน ุงูุนูุงูุงุช
    edited_df = st.data_editor(df_input, num_rows="dynamic", use_container_width=True)

    if st.button("๐ ุงุณุชุฎุฑุงุฌ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ ูุชุฑุชูุจูุง"):
        final_list = []
        rank_map = {name: i for i, name in enumerate(judges_names)}

        for _, row in edited_df.iterrows():
            case_entry = {
                'ุฑูู ุงูุทุนู': row['ุฑูู ุงูุทุนู'], 'ุงูุณูุฉ': row['ุงูุณูุฉ'],
                'ุงูุทุงุนู': row['ุงุณู ุงูุทุงุนู'], 'ุงููุญููุฉ': row['ุงููุญููุฉ ุงููุตุฏุฑ'],
                'ุงูุชููุฉ': row['ุงูุชููุฉ'],
                'ุงูููุฑุฑ': "",
                'ู1': "ูุจูู ุงููุดูู", 'ู2': "ุณุงูุญ ุนุจุฏ ุงูุฑุญูู", 'ู3': "ูุญููุฏ ุตุฏูู",
                'ู4': "", 'ู5': "",
                'sort_idx': 999
            }
            
            others = []
            for judge in judges_names:
                mark = str(row[judge]).strip()
                if mark == "+":
                    case_entry['ุงูููุฑุฑ'] = judge
                    case_entry['sort_idx'] = rank_map[judge]
                elif mark == "-"
